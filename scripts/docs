#!/bin/env bash

nvim -u tests/minit.lua --headless +'lua require("snacks.docs").build()' +qa

echo -e "\n\nGenerating Vim Help"

if [ "$GITHUB_ACTIONS" != "true" ]; then
  exit 0
fi

sudo apt update
sudo apt install -y pandoc

echo "apt installed"

PANVIMDOC="$RUNNER_TEMP/panvimdoc"

mkdir -p "$PANVIMDOC"

echo "panvimdoc created"
wget -q https://github.com/kdheepak/panvimdoc/archive/refs/tags/v4.0.1.tar.gz -O /tmp/panvimdoc.tar.gz
echo "panvimdoc downloaded"
tar -xzvf /tmp/panvimdoc.tar.gz -C "$PANVIMDOC" --strip-components=1
echo "panvimdoc extracted"

ME=$(pwd)

echo "dir: $PANVIMDOC"

cd "$PANVIMDOC" || exit 1
echo "panvimdoc directory"
ls -la

for f in "$ME"/docs/*.md; do
  ./panvimdoc.sh --project-name "snacks.nvim" --input-file "$f" --vim-version "Neovim" --demojify "true" >"$ME/doc/snacks.nvim-$(basename "$f" .md).txt"
done
